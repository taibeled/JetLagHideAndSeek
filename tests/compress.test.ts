import { expect, test } from "vitest";

import { compress, decompress } from "@/lib/utils";

test("compress and decompress", async () => {
    const originalString =
        "Hello, World! This is a test string for compression.";
    const compressed = await compress(originalString);
    const decompressed = await decompress(compressed);

    expect(decompressed).toBe(originalString);
});

test("compress really long string", async () => {
    const data =
        '{"geometry":{"coordinates":[35.7077741,139.6638239],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1543056,"extent":[35.7355569,139.624272,35.6765608,139.6942858],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Nakano","type":"district","isHidingZone":true,"questions":[]},"disabledStations":[],"hidingRadius":0.5,"alternateLocations":[{"added":true,"location":{"geometry":{"coordinates":[35.7512814,139.7087794],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1760078,"extent":[35.8008301,139.6245434,35.735779,139.7227558],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Itabashi","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.663676,139.6976754],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1759477,"extent":[35.6921567,139.6613778,35.641485,139.7239259],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Shibuya","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7528821,139.7338331],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1760038,"extent":[35.7989116,139.689393,35.7317111,139.7707372],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Kita","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6938097,139.7532163],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1761742,"extent":[35.7052349,139.7301347,35.6686296,139.7828483],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","postcode":"102-0000","name":"Chiyoda","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7080255,139.7523066],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758878,"extent":[35.7359098,139.7172608,35.6994885,139.7724617],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Bunkyo","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6706436,139.7719923],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758897,"extent":[35.6966138,139.758555,35.6402011,139.7931527],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Chuo","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6580089,139.7515137],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1761717,"extent":[35.6826516,139.7087439,35.6230363,139.7829301],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Minato","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7125805,139.7800712],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758888,"extent":[35.7316244,139.7622652,35.6948026,139.8098027],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Taito","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6092008,139.7301982],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":3554304,"extent":[35.6415938,139.695187,35.5844906,139.7799018],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Shinagawa","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.561206,139.715843],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758947,"extent":[35.6131053,139.6528251,35.4816556,139.8578153],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Ota","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6465668,139.6532284],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1759474,"extent":[35.6830054,139.582386,35.589977,139.6866146],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Setagaya","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7066318,139.868677],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1761743,"extent":[35.7512132,139.797422,35.5308279,139.9189004],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Edogawa","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7746029,139.8045163],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1760124,"extent":[35.8174827,139.7356909,35.7386591,139.8586865],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Adachi","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7433912,139.8473472],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1761718,"extent":[35.7974314,139.8132443,35.7108698,139.894564],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Katsushika","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6994929,139.6362876],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1543055,"extent":[35.7314266,139.5850878,35.6658826,139.6677991],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Suginami","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7506445,139.6162651],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1760119,"extent":[35.7798708,139.5629064,35.7117161,139.6811435],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","district":"Nerima","osm_value":"city","name":"Nerima","type":"locality"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7104196,139.8017421],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758891,"extent":[35.7435063,139.7887248,35.6866987,139.8428401],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Sumida","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6727747,139.8169621],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":3554015,"extent":[35.7080921,139.7667248,35.5886489,139.8485431],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Koto","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.6412891,139.6983834],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1758936,"extent":[35.6641392,139.6616082,35.6005708,139.7177697],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Meguro","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.725913,139.7166365],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1759506,"extent":[35.7459875,139.6775274,35.7122973,139.7525896],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","name":"Toshima","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.737529,139.78131],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":1760040,"extent":[35.7548457,139.7494526,35.7247825,139.8147363],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","osm_value":"city","postcode":"116-0000","name":"Arakawa","type":"district"}},"base":false},{"added":true,"location":{"geometry":{"coordinates":[35.7046389,139.7052761],"type":"Point"},"type":"Feature","properties":{"osm_type":"R","osm_id":17081787,"extent":[35.7095788,139.7005024,35.6979323,139.7091483],"country":"Japan","osm_key":"place","city":"Tokyo","countrycode":"JP","district":"Shinjuku","osm_value":"quarter","postcode":"160-8484","name":"Okubo","type":"locality"}},"base":false}]}';

    const compressed = await compress(data);
    const decompressed = await decompress(compressed);
    expect(decompressed).toBe(data);
});
